{% extends "base.html" %} {% load static %} {% block content %}
<main role="main" class="container p-0">
  <article class="single-post-container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <!-- Post Header -->
        <div class="single-post-header">
          <div class="breadcrumb-nav">
            <a href="/" class="breadcrumb-link">Home</a>
            <span class="breadcrumb-separator">/</span>
            {% if blog.category %}
            <a
              href="{% url 'posts_by_category' blog.category.id %}"
              class="breadcrumb-link"
              >{{ blog.category.category_name }}</a
            >
            {% endif %}
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Article</span>
          </div>

          <span class="single-post-category">
            {% if blog.category %}
              {{ blog.category.category_name }}
            {% else%}
              Uncategorized
            {% endif %}
            </span>

          <h1 class="single-post-title">{{ blog.title }}</h1>

          <div class="single-post-meta">
            <div class="author-info">
              <div class="author-avatar">
                <img src="{% static 'images/hat.png' %}" alt="Author" />
              </div>
              <div class="author-details">
                <a href="#" class="author-name">{{ blog.author }}</a>
                <div class="post-date-info">
                  <span>Published {{ blog.updated_at|timesince }} ago</span>
                </div>
              </div>
            </div>

            <div class="post-actions">
              <button class="action-btn">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path
                    d="M10 3.5L11.5 8.5H16.5L12.5 11.5L14 16.5L10 13.5L6 16.5L7.5 11.5L3.5 8.5H8.5L10 3.5Z"
                    stroke="currentColor"
                    stroke-width="1.5"
                  />
                </svg>
                Save
              </button>
              <button class="action-btn">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path
                    d="M15 10H5M10 5V15"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>
                Share
              </button>
            </div>
          </div>
        </div>

        <!-- Featured Image -->
        <div class="single-post-featured-image">
          <img src="{{ blog.featured_image.url }}" alt="{{ blog.title }}" />
        </div>

        <!-- Post Content -->
        <div class="single-post-content">{{ blog.blog_body|safe }}</div>

        <!-- Comments Section -->
        <div class="comments-section">
          <div class="comments-header">
            <h3 class="comments-title">Comments ({{ comments.count }})</h3>
          </div>

          <!-- Comment Form -->
          <div class="comment-form-wrapper">
            <h4 class="comment-form-title">Leave a Comment</h4>
            # if the user is authenicated show the form
            {% if user.is_authenticated %}
            <form
              action="{% url 'add_comment' blog.id %}"
              method="POST"
              class="comment-form"
            >
              {% csrf_token %}
              <div class="form-group">
                <textarea
                  name="text"
                  class="comment-textarea"
                  rows="4"
                  placeholder="Share your thoughts..."
                  required
                ></textarea>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn-submit-comment">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path
                      d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  Post Comment
                </button>
              </div>
            </form>
            {% else %}
            <div class="login-prompt">
              <p>
                Please <a href="{% url 'login' %}">login</a> to leave a comment.
              </p>
            </div>
            {% endif %}
          </div>

          <!-- Comments List -->
          <div class="comments-list-section">
            {% if comments %} 
            {% for comment in comments %}
            <div class="comment-item">
              <div class="comment-avatar-wrapper">
                <img
                  src="{% if comment.user.profile_picture %}{{ comment.user.profile_picture.url }}{% else %}https://via.placeholder.com/48{% endif %}"
                  alt="{{ comment.user.username }}"
                  class="comment-user-avatar"
                />
              </div>
              <div class="comment-body">
                <div class="comment-header-info">
                  <div class="comment-author-info">
                    <span class="comment-author-name"
                      >{{ comment.user.username }}</span
                    >
                    <span class="comment-date"
                      >{{ comment.created_at|timesince }} ago</span
                    >
                  </div>
                  {% if comment.user == user %}
                  <div class="comment-actions-dropdown">
                    <button class="comment-options-btn">
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                      >
                        <circle cx="12" cy="12" r="1" fill="currentColor" />
                        <circle cx="12" cy="5" r="1" fill="currentColor" />
                        <circle cx="12" cy="19" r="1" fill="currentColor" />
                      </svg>
                    </button>
                  </div>
                  {% endif %}
                </div>
                <p class="comment-text-content">{{ comment.text }}</p>
                <div class="comment-footer-actions">
                  <button class="comment-action-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M7 10v12M15 5v17M11 7v12"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      />
                    </svg>
                    Like
                  </button>
                  <button class="comment-action-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
                        stroke="currentColor"
                        stroke-width="2"
                      />
                    </svg>
                    Reply
                  </button>
                </div>
              </div>
            </div>
            {% endfor %} {% else %}
            <div class="no-comments-state">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                <path
                  d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              <h4>No comments yet</h4>
              <p>Be the first to share your thoughts!</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </article>
</main>
{% endblock %}
